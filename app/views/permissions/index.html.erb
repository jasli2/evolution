<% provide(:title, current_user.admin? ? t('permissions.page.title') : t('permissions.all.title')) %>
<% provide(:page_title, current_user.admin? ? t('permissions.page.title') : t('permissions.all.title')) %>
<% provide(:page_sub_title, current_user.admin? ? t('permissions.page.sub_title'): t('permissions.all.sub_title')) %>
<% provide(:page_icon, "iconfa-certificate") %>

<% content_for :breadcrumbs do %>
<%= content_tag(:li, current_user.admin? ? t('permissions.page.title') : t('permissions.all.title')) %>
<% end %>

<% content_for :javascript do %>

<% end %>

<div class="row-fluid">
  <div id="dashboard-left" class="span8">
    <div class="widgetbox">
      <div class="headtitle">
        <h4 class="widgettitle"><span class="iconfa-group"></span> <%= t('permissions.all.title') %></h4>
      </div>
      <% if @users.size == 0 %>
      <div class="widgetcontent">
        <p>No Permission Role setup yet. please setup it first. </p>
      </div>
      <% else %>
      <table class="table table-bordered responsive">
        <thead>
          <tr>
            <th class="center"><%= t('users.all.name') %></th>
            <th class="center"><%= t('users.all.action') %></th>
          </tr>
        </thead>
        <tbody>
        <% @users.each do |u| %>
          <tr>
            <td class="center"><%= u.name %></td>
            <td class="center">
              <%= link_to "查看详细", permission_path(u), {:class => "btn btn-primary"} %>
            </td>   
          </tr>
          <% end %>
        </tbody>
      </table>
      <div class="page-wrapper"><%= paginate @users if @users %></div>     
      <% end %>
    </div>
  </div> 
  <div id="dashboard-right" class="span4">
    <% if current_user.admin? %>
    <div class="well">
      <a href="<%= new_permission_path %>" class="btn btn-primary"><i class="iconfa-plus icon-white"></i>创建默认权限</a>
    </div>

    <h4 class="widgettitle"> <%= t('查询用户权限')%></h4>
    <div class="widgetcontent">
      <%= form_tag permissions_path, :method => 'get' do %>
      <div>
        <%= label_tag :user_id, t('用户名') %>
        <%= collection_select(nil, :user_id, User.all, :id, :name, :prompt => false) %>
      </div>
      <%= submit_tag t("permissions.all.search").html_safe, :class => "btn btn-primary" %>
      <% end %>
    </div>

    <h3 class="subtitle"><%= t("permissions.all.filter") %></h3>
    <div class="divider15"></div>
    <h4 class="widgettitle"> <%= t("permissions.all.filter") %></h4>
    <div class="widgetcontent">
      <%= form_tag permissions_path, :method => 'get' do %>
      <div>
        <%= label_tag :role, t("角色") %>  
        <select name="role">
          <option value=nil select><%= t("请选择")%></option>
          <option value="Admin"><%= t("permissions.role.admin")%></option><br/>
          <option value="Manager"><%= t("permissions.role.manager")%></option><br/>
          <option value="Teacher"><%= t("permissions.role.teacher")%></option><br/>
          <option value="Staff"><%= t("permissions.role.staff")%></option><br/>
        </select>
      </div>    
      <div>
        <%= label_tag :model_name, t("模块") %>
        <select name="model_name">
          <option value=nil select><%= t("请选择")%></option>
          <option value="User"><%= t("permissions.model.user")%></option><br/>
          <option value="Permission"><%= t("permissions.model.permission")%></option><br/>
          <option value="Ability"><%= t("permissions.model.ability")%></option><br/>
          <option value="Teacher"><%= t("permissions.model.teacher")%></option><br/>
          <option value="Course"><%= t("permissions.model.course")%></option><br/>
          <option value="Plan"><%= t("permissions.model.plan")%></option><br/>
          <option value="Knowledge"><%= t("permissions.model.knowledge")%></option><br/>
        </select>
      </div>
        <%= submit_tag t("permissions.all.filter").html_safe, :class => "btn btn-primary" %>
        <%= link_to t("competency.all.clear_filter"),  permissions_path %>
      <% end %>
  </div>
  <% end %>
</div> <!--row-fluid-->
